# Node.js

#### 1. 필요한 핵심 개념

1. 정의

* Node.js는 크롬 V8 자바스크립트 엔진으로 빌드 된 자바스크립트 런타임
* 이벤트 기반, non-blocking I/O 모델 사용
* Node.js의 패키지 생태계인 npm은 세계에서 가장 큰 오픈 소스 라이브러리 생태계
* 서버로만 사용하지 않음



2. 서버

   * 네트워크를 통해 클라이언트나 다른 서버에 정보, 서비스를 제공
   * 주로 클라이언트의 요청에 응답하는 구조

   

   **근데 왜 노드로 서버를 구성함?**

   * 런타임 : 특정 언어로 구현된 프로그램을 실행하기 위한 환경

     => 노드는 자바스크립트로 언어로 구성된 것들을 실행시키기 위한 환경

   * 자바스크립트의 실행속도가 구글에서 개발한 V8엔진에 의해 속도가 빨라짐

   * 라이언 달이라는 사람이 V8엔진을 이용해서 노드를 개발(C, C++로 구현됨)

   

3. 노드의 내부 구조

   <table style="text-align: center">
       <tr>
           <td colspan="2">Node.js Core Library</td>
       </tr>
       <tr>
           <td colspan="2">Node.js Bindings</td>
       </tr>
       <tr>
           <td>VB(오픈소스 자바스크립트 엔진)</td>
           <td>libuv(비동기 I/O)</td>
       </tr>
   </table>

   **libuv 라이브러리에 이벤트 기반, 논블로킹 I/O 모델이 구현되어 있음**

   

   1. 이벤트 기반

      * 이벤트가 발생할 때 미리 지정해 둔 작업을 수행하는 방식(click, 네트워크 요청)
      * 이벤트 리스너에 콜백 함수를 등록하여 작업을 수행 할 준비를 마친다
      * 이벤트가 동시에 발생하면 이벤트 루프가 먼저 수행 할 이벤트를 판단한다.

      

      * 자바스크립트에서의 이벤트 루프

        * 이벤트 루프 : 이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수들의 실행순서를 결정한다(노드가 종료될 때까지 반복함)

        * 테스크 큐(콜백 큐) : 이벤트 발생 후 호출 되어야 하는 콜백함수들이 저장되는 공간

        * 백그라운드(Web API) : 타이머, I/O 작업, 이벤트 리스너 등이 대기하는 공간

          

          1.  비동기 함수가 호출되면, 해당 function이 백그라운드로 올라간다(setTimeout일 경우 지정된 시간동안 대기)

          ![javascript-event-loop-step-1](https://user-images.githubusercontent.com/20276476/72710458-7ca6b280-3baa-11ea-9027-3b70859137e4.png)

          

          2. 시간이 지나면 이벤트 루프가 태스크 큐(콜백 큐)에 작업을 등록시킨다

          ![javascript-event-loop-step-2](https://user-images.githubusercontent.com/20276476/72710530-a364e900-3baa-11ea-97a5-cf42514324a8.png)

          

          3.  큐에 있던 작업이 Stack 영역으로 올라와 함수가 실행된다

        ![javascript-event-loop-step-3](https://user-images.githubusercontent.com/20276476/72710544-af50ab00-3baa-11ea-87fc-eb2665e8f513.png)

        **http://latentflip.com.com/loupe** -> 여기 이벤트 루프를 애니메이션처럼 볼 수 있다

   

   2. 논블로킹 I/O

      * 함수를 백그라운드로 보내고 다음 코드가 먼저 실행되게 한 후, 백그라운드로 보낸 함수가 스택 영역으로 올라오게 하는 것

      * 이전 작업을 기다리지 않고(blocking 방식), 바로 다음작업을 수행

      * 일반적으로 파일 시스템, 입출력, 네트워크 요청 등을 논블로킹I/O방식으로 동작함

      * setTimeout(function(){...}, 0)이 일반적인 논블로킹 방식으로 만드는 방법

        => 노드에서는 다른 방법이 있다

        

   3. 스레드

      * 작업을 처리하는 단위
      * 노드는 싱글 스레드로 작업
      * 프로세스와의 차이점
        * 프로세스
          * 운영체제에서 할당하는 작업 단위
          * 프로세스끼리는 자원을 공유하지 않는다
        * 쓰레드
          * 프로세스 내에서 실행되는 흐름의 단위
          * 프로세스 내의 자원을 공유한다(쓰레드간 같은 메모리에 접근이 가능하다)

   

#### 2. 서버에서의 노드

 1. 장단점

    | 장점                                            | 단점                                          |
    | ----------------------------------------------- | --------------------------------------------- |
    | 멀티 스레드 방식에 비해 컴퓨터 자원을 적게 사용 | 싱글 스레드라서 CPU 코어를 하나만 사용        |
    | I/O 작업이 많은 서버로 적합                     | CPU 작업이 많은 서버로는 부적합               |
    | 멀티 스레드 방식보다 구현이 쉽다                | 스레드가 하나뿐이므로 멈추지 않게 관리해야 함 |
    | 웹 서버가 내장 되어 있다                        | 서버 규모가 커지면 관리가 힘들다              |
    | 자바스크립트를 사용                             | 어중간한 성능                                 |
    | JSON 형식과 호환이 쉽다                         | -                                             |



#### 3. 서버 외의 노드

* 자바스크립트 런타임 => 서버에만 용도가 한정되지 않음
* 웹, 모바일, 데스크톱 애플리케이션에도 사용됨
* Angular, React, Vue, Meteor 등



#### 4. 설치

* 윈도우

  * 노드의 공식 사이트로 간다 - **https://nodejs.org**
  * 왼쪽 LTS버전을 다운로드
  * Next를 눌러 설치를 완료시킨다
  * 커맨드 창에서 node -v 또는 node --version이라고 입력하여 버전이 뜨면 설치를 확인 할 수 있다
  * 마찬가지로 npm -v 또는 npm --version을 입력하면 패키지 설치도 확인이 가능하다

  















